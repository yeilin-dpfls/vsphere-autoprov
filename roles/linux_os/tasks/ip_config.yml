---
# Nginx VM (Rocky Linux)의 IP를 172.16.3.100으로 영구 설정하는 태스크

- name: 1.1 SSH 연결 확인 (초기 IP로)
  ansible.builtin.wait_for_connection:
    timeout: 60

- name: 1.2 네트워크 설정 파일 배포 (172.16.3.100/24)
  # Rocky Linux 표준 경로에 새로운 IP 설정 내용을 직접 작성
  ansible.builtin.copy:
    dest: /etc/sysconfig/network-scripts/ifcfg-eth0
    owner: root
    group: root
    mode: '0644'
    content: |
      TYPE=Ethernet
      BOOTPROTO=static
      NAME=eth0
      DEVICE=eth0
      ONBOOT=yes
      IPADDR={{ nginx_ip | split('/') | first }}
      PREFIX={{ nginx_ip | split('/') | last }}
      GATEWAY={{ nginx_gateway }}

- name: 1.3 네트워크 서비스 재시작 및 연결 끊기
  ansible.builtin.service:
    name: network 
    state: restarted
  ignore_errors: yes # SSH 연결이 끊어지는 것을 예상
